<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš¡ï¸ å°æ–°çš„è¶…èƒ½åŠ›æ‰¹æ¬¡ç›¸ç°¿ï¼</title>
    <style>
        /* ğŸ–ï¸ è Ÿç­†å°æ–°å‹•ç•«é¢¨æ ¼ CSS */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f7e6f6; /* è Ÿç­†ç²‰è‰²èª¿ */
            color: #333;
        }
        .container {
            background-color: #fff;
            padding: 40px 30px;
            border-radius: 20px;
            border: 4px solid #1a1a1a; /* ç²—é»‘ç·šæ¢ */
            box-shadow: 10px 10px 0 #ff69b4; /* ä¿çš®çš„é™°å½± */
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        h1 {
            color: #ff0000; /* å°æ–°æœ€æ„›çš„ç´…è‰² */
            font-size: 2.5em;
            text-shadow: 2px 2px 0 #ffff00; /* é»ƒè‰²é‚Šæ¡† */
            margin-bottom: 5px;
        }
        p {
            font-weight: 700;
            color: #444;
        }
        
        /* æ‹–æ›³å€å¡Šæ¨£å¼ */
        #dropArea {
            border: 3px dashed #ff69b4; /* é»é»è™›ç·š */
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            background-color: #fff0f5;
        }
        #dropArea.drag-over {
            background-color: #fff;
            border-color: #00ff00; /* æ‹–æ›³æ™‚è®Šç¶ è‰² */
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
        }
        
        /* éš±è—çš„æª”æ¡ˆé¸æ“‡å™¨ï¼Œä½†å…è¨±é¸å–å¤šå€‹æª”æ¡ˆ */
        #photoFile {
            display: none;
        }

        .file-list {
            text-align: left;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-top: 15px;
        }
        .file-list p {
            font-size: 0.9em;
            color: #666;
            margin: 5px 0;
        }

        button {
            padding: 12px 25px;
            margin-top: 20px;
            font-size: 1.1em;
            background-color: #007bff;
            color: white;
            border: 3px solid #1a1a1a; /* ç²—é»‘é‚Š */
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            border-radius: 8px;
            font-weight: 900;
        }
        button:active {
            transform: translate(2px, 2px);
            box-shadow: 0 0 0 #1a1a1a;
        }
        
        .message-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            text-align: left;
        }
        .success { background-color: #d4edda; color: #155724; border: 2px solid #155724;}
        .error { background-color: #f8d7da; color: #721c24; border: 2px solid #721c24;}
        .loading { background-color: #ffeeba; color: #856404; border: 2px solid #856404;}
        .result-item { margin-bottom: 5px; font-size: 0.9em; }
        .result-item.ok { color: green; }
        .result-item.fail { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‘¶ æ‰¹æ¬¡ä¸Šå‚³ï¼å¹«å°æ–°æ”¶é›†å‹•æ„Ÿè¶…äººå¡</h1>
        <p>å¯ä»¥ä¸€æ¬¡é¸å–å¤šå¼µç…§ç‰‡ï¼Œæˆ–ç›´æ¥æŠŠæª”æ¡ˆæ‹–æ›³åˆ°ä¸‹æ–¹å€åŸŸå–”ï¼</p>

        <div id="dropArea">
            <input type="file" id="photoFile" accept="image/*,video/*" multiple>
            <p style="font-size: 1.2em;">æŠŠç…§ç‰‡/å½±ç‰‡æ‹–æ›³åˆ°é€™è£¡ï¼<br>æˆ–é»æ“Šæ­¤è™•é¸å–æª”æ¡ˆ</p>
            <div id="fileList" class="file-list" style="display: none;">å·²é¸æ“‡æª”æ¡ˆåˆ—è¡¨ï¼š</div>
        </div>

        <button id="uploadButton" onclick="uploadPhoto()">é–‹å§‹ä¸Šå‚³ (ç™¼å°„ï¼)</button>

        <div id="message" class="message-box loading" style="display: none;"></div>
    </div>

    <script>
        // âœ¨ âœ¨ âœ¨ é€™è£¡æ˜¯ä½ å¾Œç«¯æœå‹™çš„å…¬é–‹ç¶²å€ï¼ âœ¨ âœ¨ âœ¨
        const BACKEND_URL = 'https://myphotostorage-backend.zeabur.app';
        
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('photoFile');
        const fileListElement = document.getElementById('fileList');
        const messageElement = document.getElementById('message');
        const uploadButton = document.getElementById('uploadButton');
        let selectedFiles = []; // ç”¨ä¾†å„²å­˜æ‰€æœ‰é¸ä¸­çš„æª”æ¡ˆ

        // --- æ‹–æ›³äº‹ä»¶ç›£è½ (å¯¦ç¾æ‹–æ›³ä¸Šå‚³) ---

        // é»æ“Šæ‹–æ›³å€åŸŸæ™‚ï¼Œè§¸ç™¼æª”æ¡ˆé¸æ“‡
        dropArea.addEventListener('click', () => fileInput.click());

        // æ‹–æ›³é€²å…¥
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.classList.add('drag-over');
        });

        // æ‹–æ›³é›¢é–‹
        dropArea.addEventListener('dragleave', () => {
            dropArea.classList.remove('drag-over');
        });

        // æª”æ¡ˆæ”¾é–‹ (Drop)
        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.classList.remove('drag-over');
            
            // å–å¾—æ‹–æ›³é€²ä¾†çš„æª”æ¡ˆåˆ—è¡¨
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        // æª”æ¡ˆé¸æ“‡è®Šæ›´ (Change)
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            selectedFiles = Array.from(files);
            updateFileListDisplay();
        }

        function updateFileListDisplay() {
            if (selectedFiles.length === 0) {
                fileListElement.style.display = 'none';
                uploadButton.disabled = true;
                return;
            }

            fileListElement.style.display = 'block';
            uploadButton.disabled = false;
            
            let listHTML = `<p>å·²é¸å– **${selectedFiles.length}** å€‹æª”æ¡ˆï¼š</p><ul>`;
            selectedFiles.forEach(file => {
                listHTML += `<li>${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)</li>`;
            });
            listHTML += '</ul>';
            fileListElement.innerHTML = listHTML;
        }


        // --- ä¸Šå‚³é‚è¼¯ ---

        async function uploadPhoto() {
            if (selectedFiles.length === 0) {
                messageElement.className = 'message-box error';
                messageElement.textContent = 'âŒ è«‹å…ˆé¸æ“‡æª”æ¡ˆï¼';
                messageElement.style.display = 'block';
                return;
            }
            
            uploadButton.disabled = true;
            messageElement.className = 'message-box loading';
            messageElement.style.display = 'block';
            messageElement.innerHTML = `ğŸš€ æ­£åœ¨ä¸Šå‚³ **${selectedFiles.length}** å€‹æª”æ¡ˆï¼Œè«‹ç­‰å¾…å°æ–°ç™¼åŠŸ...`;
            
            // æº–å‚™å‚³é€çµ¦å¾Œç«¯çš„è³‡æ–™
            const formData = new FormData();
            // æ³¨æ„ï¼šé€™è£¡çš„ key å¿…é ˆæ˜¯ 'photos'ï¼Œè¦å’Œå¾Œç«¯ server.js è£¡çš„ upload.array('photos') ç›¸ç¬¦ï¼
            selectedFiles.forEach(file => {
                formData.append('photos', file); 
            });

            try {
                const response = await fetch(`${BACKEND_URL}/upload`, {
                    method: 'POST',
                    body: formData 
                });

                const result = await response.json(); 

                if (response.ok) {
                    // æˆåŠŸç‹€æ…‹ç¢¼ (ä¾‹å¦‚ 200)
                    messageElement.className = 'message-box success';
                    let successHTML = `âœ… **ä¸Šå‚³å¤§æˆåŠŸï¼** å…± ${result.results.length} å€‹æª”æ¡ˆè™•ç†å®Œç•¢ã€‚<br><hr>`;
                    result.results.forEach(item => {
                        if (item.status === 'success') {
                            successHTML += `<div class="result-item ok">âœ”ï¸ ${item.fileName} ä¸Šå‚³æˆåŠŸï¼</div>`;
                        } else {
                            successHTML += `<div class="result-item fail">âŒ ${item.fileName} å¤±æ•—ï¼š${item.error}</div>`;
                        }
                    });
                    messageElement.innerHTML = successHTML;
                    
                    // æ¸…é™¤æª”æ¡ˆåˆ—è¡¨
                    selectedFiles = [];
                    updateFileListDisplay();

                } else {
                    // å¤±æ•—ç‹€æ…‹ç¢¼
                    messageElement.className = 'message-box error';
                    messageElement.textContent = `âŒ ä¸Šå‚³éç¨‹ç™¼ç”ŸéŒ¯èª¤ï¼è¨Šæ¯ï¼š${result.error || 'æœªçŸ¥éŒ¯èª¤'}`;
                }

            } catch (error) {
                console.error(error);
                messageElement.className = 'message-box error';
                messageElement.textContent = `ğŸš¨ ç™¼ç”Ÿç¶²è·¯é€£ç·šéŒ¯èª¤ï¼è«‹ç¢ºèªå¾Œç«¯æœå‹™æ˜¯å¦æ­£å¸¸é‹è¡Œã€‚`;
            } finally {
                uploadButton.disabled = false;
            }
        }

        // åˆå§‹åŒ–é¡¯ç¤º
        updateFileListDisplay();
    </script>
</body>
</html>